# Архитектурное Предложение: Интеграция GigaChat/GigaChain и Обеспечение Отказоустойчивости

## 1. Анализ GigaChat API и GigaChain

### 1.1. Доступность и Тарифы
Согласно проведенному анализу [1] [2], GigaChat API **доступен для некоммерческих проектов без дополнительной оплаты**. Это полностью соответствует вашему требованию использовать бесплатные ресурсы. Для коммерческого использования существуют тарифные планы.

### 1.2. GigaChain
**GigaChain** [3] — это библиотека, разработанная для интеграции GigaChat с фреймворком LangChain. Это означает, что GigaChat может быть легко включен в существующую архитектуру агента, заменив или дополнив текущую LLM (`gpt-4.1-mini`).

## 2. Предложение по Архитектуре: Оркестратор и Отказоустойчивость

Ваше требование использовать GigaChat как **оркестратор**, который работает **параллельно**, но при этом **не является критической точкой отказа**, является ключевым для создания надежного агента.

### 2.1. Концепция: Двухуровневый LLM-Провайдер (Fallback Mechanism)

Мы реализуем **стратегию резервирования (Fallback)**, где GigaChat будет выступать в роли **Основного Провайдера (Primary)**, а текущая модель (`gpt-4.1-mini`) — в роли **Резервного Провайдера (Secondary)**.

| Уровень | Провайдер | Роль | Преимущество |
| :--- | :--- | :--- | :--- |
| **Primary** | GigaChat (через GigaChain) | Основной генератор сообщений | Локализация, потенциально более низкая задержка, бесплатный доступ. |
| **Secondary** | `gpt-4.1-mini` (через LangChain) | Резервный генератор сообщений | Гарантированная работа при сбое GigaChat API. |

### 2.2. Реализация Отказоустойчивости (Orchestration)

В файле `agent_core.py` будет реализована функция-обертка, которая:

1.  Пытается вызвать GigaChat (Primary).
2.  Если GigaChat возвращает ошибку (таймаут, ошибка авторизации, ошибка сервера), то функция **автоматически переключается** на вызов `gpt-4.1-mini` (Secondary).
3.  Если оба провайдера недоступны, возвращается сообщение об ошибке.

Таким образом, GigaChat будет работать как оркестратор, но его сбой не "убьет" всю систему, а лишь переключит ее на резервный канал.

## 3. План Действий

1.  **Установка GigaChain:** Установить необходимую библиотеку.
2.  **Обновление `agent_core.py`:** Внедрить логику Fallback с GigaChat и `gpt-4.1-mini`.
3.  **Обновление `proactive_agent.py`:** Заменить имитацию Pyrogram на реальный код.
4.  **Обновление `README.md`:** Добавить инструкции по получению токена GigaChat и авторизации Pyrogram.

---
### Ссылки

[1] GigaChat API is available for users to create non-commercial projects at no additional cost.
[2] Тарифы GigaChat API | Документация для разработчиков - Условия коммерческого использования.
[3] ai-forever/gigachain - GitHub репозиторий для интеграции GigaChat с LangChain.
